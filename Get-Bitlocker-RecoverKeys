Import-Module ActiveDirectory
Get-ADComputer -Filter 'ObjectClass -eq "computer"' -SearchBase "OU=,DC=,DC=" | foreach-object {
$Computer = $_.name
#Verify Computer Object Existence
$Computer_Object = Get-ADComputer -Filter {cn -eq $Computer} -Property msTPM-OwnerInformation, msTPM-TpmInformationForComputer
if($Computer_Object -eq $null){
Write-Host "Error"
}
#Verify if Computer Object as Bitlocker properties
$Bitlocker_Object = Get-ADObject -Filter {objectclass -eq 'msFVE-RecoveryInformation'} -SearchBase $Computer_Object.DistinguishedName -Properties 'msFVE-RecoveryPassword'
if($Bitlocker_Object.'msFVE-RecoveryPassword'){
$BitLocker_Key = $BitLocker_Object.'msFVE-RecoveryPassword'
}else{
$BitLocker_Key = "none"
}
#Verbose
$strToReport = $Computer + "," + $BitLocker_Key
Write-Host $strToReport
#Export as Text File
$strToReport | out-file "\\path\file.txt" -append
}
